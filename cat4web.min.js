function CAT4Web(){function n(){var n=new XMLHttpRequest;n.open("POST","https://cat4web.r8acc.ru/licence/request",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&(200===n.status?o("token",JSON.parse(n.responseText)):(u.close(),console.log("Could not get access key. Send mail to i@r8acc.ru.")))},n.send()}function e(){r.onDisconnect(),i&&(i=!1,setTimeout(function(){r.connect()},r.reconnectTimeout))}function t(n){var e=JSON.parse(n.data);if(!0===e.auth)c=!0,r.onConnect();else switch(e.type){case"rig-number":a=null!==e.value?parseInt(e.value):null,r.onChangeRigNumber(a);break;case"status":l=null!==e.value?parseInt(e.value):null,r.onChangeStatus(l);break;case"freq":h=null!==e.value?parseInt(e.value):null,r.onChangeFrequency(h);break;case"mode":f=null!==e.value?parseInt(e.value):null,r.onChangeMode(f);break;case"ptt":S=!!e.value,r.onChangePTT(S)}}function o(n,e){i&&u.send(n+"="+e)}this.MODE_CW_U=8388608,this.MODE_CW_L=16777216,this.MODE_SSB_U=33554432,this.MODE_SSB_L=67108864,this.MODE_DIG_U=134217728,this.MODE_DIG_L=268435456,this.MODE_AM=536870912,this.MODE_FM=1073741824,this.STATUS_NOTCONFIGURED=0,this.STATUS_DISABLED=1,this.STATUS_PORTBUSY=2,this.STATUS_NOTRESPONDING=3,this.STATUS_ONLINE=4,this.reconnectTimeout=5e3,this.secureConnection="https:"===location.protocol;var s="cat4web.localhost.r8acc.ru",u=null,i=!1,c=!1,r=this,a=null,l=null,h=null,f=null,S=!1;this.onConnect=function(){},this.onDisconnect=function(){},this.onChangeRigNumber=function(n){},this.onChangeStatus=function(n){},this.onChangeFrequency=function(n){},this.onChangeMode=function(n){},this.onChangePTT=function(n){},this.isActive=function(){return c},this.getRigNumber=function(){return a},this.setRigNumber=function(n){o("rig-number",n)},this.getStatus=function(){return l},this.getFrequency=function(){return h},this.setFrequency=function(n){h=n,o("freq",n)},this.getMode=function(){return f},this.setMode=function(n){o("mode",n)},this.getPTT=function(){return S},this.connect=function(){return"function"!=typeof WebSocket?(console.log("WebSocket not supported for you. Sorry."),!1):!i&&(i=!0,u=new WebSocket(this.secureConnection?"wss://"+s+":34469":"ws://"+s+":34468"),u.onopen=n,u.onclose=e,u.onmessage=t,!0)},this.disconnect=function(){return i=c=!1,!!u&&(u.close(),!0)}}
