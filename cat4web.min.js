function CAT4Web(){this.MODE_CW_U=8388608,this.MODE_CW_L=16777216,this.MODE_SSB_U=33554432,this.MODE_SSB_L=67108864,this.MODE_DIG_U=134217728,this.MODE_DIG_L=268435456,this.MODE_AM=536870912,this.MODE_FM=1073741824,this.STATUS_NOTCONFIGURED=0,this.STATUS_DISABLED=1,this.STATUS_PORTBUSY=2,this.STATUS_NOTRESPONDING=3,this.STATUS_ONLINE=4,this.reconnectTimeout=5e3,this.secureConnection="https:"===location.protocol;var i=null,r=!1,t=!1,u=this,s={},o=null;function e(){var e=new XMLHttpRequest;e.open("POST","https://cat4web.r8acc.ru/licence/request",!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&(200===e.status?i.send("token:"+JSON.parse(e.responseText)):(i.close(),console.log("Could not get access key. Send mail to i@r8acc.ru.")))},e.send()}function n(){u.onDisconnect(),r&&(r=!1,setTimeout(function(){u.connect()},u.reconnectTimeout))}function c(e){var n=JSON.parse(e.data);if(!0===n.auth)t=!0,u.onConnect();else if(n.version)o=n.version;else switch(n.type){case"status":f(n.rig,"status",null!==n.value?parseInt(n.value):null),u.onChangeStatus(n.rig,s[n.rig].status);break;case"freq":f(n.rig,"frequency",null!==n.value?parseInt(n.value):null),u.onChangeFrequency(n.rig,l(n.rig,"frequency"));break;case"rx-freq":f(n.rig,"rx-frequency",null!==n.value?parseInt(n.value):null),u.onChangeRxFrequency(n.rig,l(n.rig,"rx-frequency"));break;case"tx-freq":f(n.rig,"tx-frequency",null!==n.value?parseInt(n.value):null),u.onChangeTxFrequency(n.rig,l(n.rig,"tx-frequency"));break;case"freq-offset":f(n.rig,"frequency-offset",null!==n.value?parseInt(n.value):null),u.onChangeFrequencyOffset(n.rig,l(n.rig,"frequency-offset"));break;case"rit":f(n.rig,"rit",null!==n.value?!!n.value:null),u.onChangeRIT(n.rig,l(n.rig,"rit"));break;case"xit":f(n.rig,"xit",null!==n.value?!!n.value:null),u.onChangeXIT(n.rig,l(n.rig,"xit"));break;case"mode":f(n.rig,"mode",null!==n.value?parseInt(n.value):null),u.onChangeMode(n.rig,l(n.rig,"mode"));break;case"ptt":f(n.rig,"ptt",!!n.value),u.onChangePTT(n.rig,l(n.rig,"ptt"))}}function a(e,n,t){r&&i.send(e+":"+n+":"+t)}function l(e,n){return e&&s[e]?s[e][n]:null}function f(e,n,t){e&&(s[e]||(s[e]={}),s[e][n]=t)}this.onConnect=function(){},this.onDisconnect=function(){},this.onChangeStatus=function(e,n){},this.onChangeFrequency=function(e,n){},this.onChangeRxFrequency=function(e,n){},this.onChangeTxFrequency=function(e,n){},this.onChangeFrequencyOffset=function(e,n){},this.onChangeRIT=function(e,n){},this.onChangeXIT=function(e,n){},this.onChangeMode=function(e,n){},this.onChangePTT=function(e,n){},this.isActive=function(){return t},this.getVersion=function(){return o},this.getStatus=function(e){return l(e,"status")},this.getStatusText=function(e){switch(l(e,"status")){case u.STATUS_NOTCONFIGURED:return"Rig is not configured";case u.STATUS_DISABLED:return"Rig is disabled";case u.STATUS_PORTBUSY:return"Port is not available";case u.STATUS_NOTRESPONDING:return"Rig is not responding";case u.STATUS_ONLINE:return"On-line"}},this.getFrequency=function(e){return l(e,"frequency")},this.setFrequency=function(e,n){f(e,"frequency",n),a(e,"freq",n)},this.getRxFrequency=function(e){return l(e,"rx-frequency")},this.getTxFrequency=function(e){return l(e,"tx-frequency")},this.getFrequencyOffset=function(e){return l(e,"frequency-offset")},this.getRIT=function(e){return l(e,"rit")},this.setRIT=function(e,n){a(e,"rit",!!n)},this.getXIT=function(e){return l(e,"xit")},this.setXIT=function(e,n){a(e,"xit",!!n)},this.getMode=function(e){return l(e,"mode")},this.setMode=function(e,n){a(e,"mode",n)},this.getPTT=function(e){return l(e,"ptt")},this.setPTT=function(e,n){a(e,"ptt",!!n)},this.connect=function(){return o=null,"function"!=typeof WebSocket?(console.log("WebSocket not supported for you. Sorry."),!1):!r&&(r=!0,(i=new WebSocket(this.secureConnection?"wss://cat4web.localhost.r8acc.ru:34469":"ws://127.0.0.1:34468")).onopen=e,i.onclose=n,i.onmessage=c,!0)},this.disconnect=function(){return o=null,r=t=!1,!!i&&(i.close(),!0)}}
