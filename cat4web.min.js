function CAT4Web(){this.MODE_CW_U=8388608,this.MODE_CW_L=16777216,this.MODE_SSB_U=33554432,this.MODE_SSB_L=67108864,this.MODE_DIG_U=134217728,this.MODE_DIG_L=268435456,this.MODE_AM=536870912,this.MODE_FM=1073741824,this.STATUS_NOTCONFIGURED=0,this.STATUS_DISABLED=1,this.STATUS_PORTBUSY=2,this.STATUS_NOTRESPONDING=3,this.STATUS_ONLINE=4,this.reconnectTimeout=5e3,this.secureConnection="https:"===location.protocol;var e="cat4web.localhost.r8acc.ru",n=null,t=!1,i=!1,r=this,u={},s=null;function o(){var e=new XMLHttpRequest;e.open("POST","https://cat4web.r8acc.ru/licence/request",!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&(200===e.status?n.send("token:"+JSON.parse(e.responseText)):(n.close(),console.log("Could not get access key. Send mail to i@r8acc.ru.")))},e.send()}function c(){r.onDisconnect(),t&&(t=!1,setTimeout(function(){r.connect()},r.reconnectTimeout))}function a(e){var n=JSON.parse(e.data);if(!0===n.auth)i=!0,r.onConnect();else if(n.version)s=n.version;else switch(n.type){case"status":h(n.rig,"status",null!==n.value?parseInt(n.value):null),r.onChangeStatus(n.rig,u[n.rig].status);break;case"freq":h(n.rig,"frequency",null!==n.value?parseInt(n.value):null),r.onChangeFrequency(n.rig,f(n.rig,"frequency"));break;case"rx-freq":h(n.rig,"rx-frequency",null!==n.value?parseInt(n.value):null),r.onChangeRxFrequency(n.rig,f(n.rig,"rx-frequency"));break;case"tx-freq":h(n.rig,"tx-frequency",null!==n.value?parseInt(n.value):null),r.onChangeTxFrequency(n.rig,f(n.rig,"tx-frequency"));break;case"freq-offset":h(n.rig,"frequency-offset",null!==n.value?parseInt(n.value):null),r.onChangeFrequencyOffset(n.rig,f(n.rig,"frequency-offset"));break;case"rit":h(n.rig,"rit",null!==n.value?!!n.value:null),r.onChangeRIT(n.rig,f(n.rig,"rit"));break;case"xit":h(n.rig,"xit",null!==n.value?!!n.value:null),r.onChangeXIT(n.rig,f(n.rig,"xit"));break;case"mode":h(n.rig,"mode",null!==n.value?parseInt(n.value):null),r.onChangeMode(n.rig,f(n.rig,"mode"));break;case"ptt":h(n.rig,"ptt",!!n.value),r.onChangePTT(n.rig,f(n.rig,"ptt"))}}function l(e,i,r){t&&n.send(e+":"+i+":"+r)}function f(e,n){return e&&u[e]?u[e][n]:null}function h(e,n,t){e&&(u[e]||(u[e]={}),u[e][n]=t)}this.onConnect=function(){},this.onDisconnect=function(){},this.onChangeStatus=function(e,n){},this.onChangeFrequency=function(e,n){},this.onChangeRxFrequency=function(e,n){},this.onChangeTxFrequency=function(e,n){},this.onChangeFrequencyOffset=function(e,n){},this.onChangeRIT=function(e,n){},this.onChangeXIT=function(e,n){},this.onChangeMode=function(e,n){},this.onChangePTT=function(e,n){},this.isActive=function(){return i},this.getVersion=function(){return s},this.getStatus=function(e){return f(e,"status")},this.getStatusText=function(e){switch(f(e,"status")){case r.STATUS_NOTCONFIGURED:return"Rig is not configured";case r.STATUS_DISABLED:return"Rig is disabled";case r.STATUS_PORTBUSY:return"Port is not available";case r.STATUS_NOTRESPONDING:return"Rig is not responding";case r.STATUS_ONLINE:return"On-line"}},this.getFrequency=function(e){return f(e,"frequency")},this.setFrequency=function(e,n){h(e,"frequency",n),l(e,"freq",n)},this.getRxFrequency=function(e){return f(e,"rx-frequency")},this.getTxFrequency=function(e){return f(e,"tx-frequency")},this.getFrequencyOffset=function(e){return f(e,"frequency-offset")},this.getRIT=function(e){return f(e,"rit")},this.setRIT=function(e,n){l(e,"rit",!!n)},this.getXIT=function(e){return f(e,"xit")},this.setXIT=function(e,n){l(e,"xit",!!n)},this.getMode=function(e){return f(e,"mode")},this.setMode=function(e,n){l(e,"mode",n)},this.getPTT=function(e){return f(e,"ptt")},this.setPTT=function(e,n){l(e,"ptt",!!n)},this.connect=function(){return s=null,"function"!=typeof WebSocket?(console.log("WebSocket not supported for you. Sorry."),!1):!t&&(t=!0,(n=new WebSocket(this.secureConnection?"wss://"+e+":34469":"ws://"+e+":34468")).onopen=o,n.onclose=c,n.onmessage=a,!0)},this.disconnect=function(){return s=null,t=i=!1,!!n&&(n.close(),!0)}}
