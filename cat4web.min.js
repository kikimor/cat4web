function CAT4Web(){this.MODE_CW_U=8388608,this.MODE_CW_L=16777216,this.MODE_SSB_U=33554432,this.MODE_SSB_L=67108864,this.MODE_DIG_U=134217728,this.MODE_DIG_L=268435456,this.MODE_AM=536870912,this.MODE_FM=1073741824,this.STATUS_NOTCONFIGURED=0,this.STATUS_DISABLED=1,this.STATUS_PORTBUSY=2,this.STATUS_NOTRESPONDING=3,this.STATUS_ONLINE=4,this.reconnectTimeout=5e3,this.secureConnection="https:"===location.protocol;var n="cat4web.localhost.r8acc.ru",e=null,t=!1,o=!1,s=this,i=null,u=null,c=null,r=null,a=!1;function l(){var n=new XMLHttpRequest;n.open("POST","https://cat4web.r8acc.ru/licence/request",!0),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&(200===n.status?T("token",JSON.parse(n.responseText)):(e.close(),console.log("Could not get access key. Send mail to i@r8acc.ru.")))},n.send()}function h(){s.onDisconnect(),t&&(t=!1,setTimeout(function(){s.connect()},s.reconnectTimeout))}function S(n){var e=JSON.parse(n.data);if(!0===e.auth)o=!0,s.onConnect();else switch(e.type){case"rig-number":i=null!==e.value?parseInt(e.value):null,s.onChangeRigNumber(i);break;case"status":u=null!==e.value?parseInt(e.value):null,s.onChangeStatus(u);break;case"freq":c=null!==e.value?parseInt(e.value):null,s.onChangeFrequency(c);break;case"mode":r=null!==e.value?parseInt(e.value):null,s.onChangeMode(r);break;case"ptt":a=!!e.value,s.onChangePTT(a)}}function T(n,o){t&&e.send(n+"="+o)}this.onConnect=function(){},this.onDisconnect=function(){},this.onChangeRigNumber=function(n){},this.onChangeStatus=function(n){},this.onChangeFrequency=function(n){},this.onChangeMode=function(n){},this.onChangePTT=function(n){},this.isActive=function(){return o},this.getRigNumber=function(){return i},this.setRigNumber=function(n){T("rig-number",n)},this.getStatus=function(){return u},this.getStatusText=function(){switch(u){case s.STATUS_NOTCONFIGURED:return"Rig is not configured";case s.STATUS_DISABLED:return"Rig is disabled";case s.STATUS_PORTBUSY:return"Port is not available";case s.STATUS_NOTRESPONDING:return"Rig is not responding";case s.STATUS_ONLINE:return"On-line"}},this.getFrequency=function(){return c},this.setFrequency=function(n){c=n,T("freq",n)},this.getMode=function(){return r},this.setMode=function(n){T("mode",n)},this.getPTT=function(){return a},this.connect=function(){return"function"!=typeof WebSocket?(console.log("WebSocket not supported for you. Sorry."),!1):!t&&(t=!0,(e=new WebSocket(this.secureConnection?"wss://"+n+":34469":"ws://"+n+":34468")).onopen=l,e.onclose=h,e.onmessage=S,!0)},this.disconnect=function(){return t=o=!1,!!e&&(e.close(),!0)}}
