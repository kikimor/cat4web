function CAT4Web(){this.MODE_CW_U=8388608,this.MODE_CW_L=16777216,this.MODE_SSB_U=33554432,this.MODE_SSB_L=67108864,this.MODE_DIG_U=134217728,this.MODE_DIG_L=268435456,this.MODE_AM=536870912,this.MODE_FM=1073741824,this.STATUS_NOTCONFIGURED=0,this.STATUS_DISABLED=1,this.STATUS_PORTBUSY=2,this.STATUS_NOTRESPONDING=3,this.STATUS_ONLINE=4,this.reconnectTimeout=5e3,this.secureConnection="https:"===location.protocol;var e="cat4web.localhost.r8acc.ru",n=null,t=!1,i=!1,o=this,s={};function u(){var e=new XMLHttpRequest;e.open("POST","https://cat4web.r8acc.ru/licence/request",!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&(200===e.status?n.send("token:"+JSON.parse(e.responseText)):(n.close(),console.log("Could not get access key. Send mail to i@r8acc.ru.")))},e.send()}function r(){o.onDisconnect(),t&&(t=!1,setTimeout(function(){o.connect()},o.reconnectTimeout))}function c(e){var n=JSON.parse(e.data);if(!0===n.auth)i=!0,o.onConnect();else switch(n.type){case"status":l(n.rig,"status",null!==n.value?parseInt(n.value):null),o.onChangeStatus(n.rig,s[n.rig].status);break;case"freq":l(n.rig,"frequency",null!==n.value?parseInt(n.value):null),o.onChangeFrequency(n.rig,h(n.rig,"frequency"));break;case"rx-freq":l(n.rig,"rx-frequency",null!==n.value?parseInt(n.value):null),o.onChangeRxFrequency(n.rig,h(n.rig,"rx-frequency"));break;case"tx-freq":l(n.rig,"tx-frequency",null!==n.value?parseInt(n.value):null),o.onChangeTxFrequency(n.rig,h(n.rig,"tx-frequency"));break;case"mode":l(n.rig,"mode",null!==n.value?parseInt(n.value):null),o.onChangeMode(n.rig,h(n.rig,"mode"));break;case"ptt":l(n.rig,"ptt",!!n.value),o.onChangePTT(n.rig,h(n.rig,"ptt"))}}function a(e,i,o){t&&n.send(e+":"+i+":"+o)}function h(e,n){return e&&s[e]?s[e][n]:null}function l(e,n,t){e&&(s[e]||(s[e]={}),s[e][n]=t)}this.onConnect=function(){},this.onDisconnect=function(){},this.onChangeStatus=function(e,n){},this.onChangeFrequency=function(e,n){},this.onChangeRxFrequency=function(e,n){},this.onChangeTxFrequency=function(e,n){},this.onChangeMode=function(e,n){},this.onChangePTT=function(e,n){},this.isActive=function(){return i},this.getStatus=function(e){return h(e,"status")},this.getStatusText=function(e){switch(h(e,"status")){case o.STATUS_NOTCONFIGURED:return"Rig is not configured";case o.STATUS_DISABLED:return"Rig is disabled";case o.STATUS_PORTBUSY:return"Port is not available";case o.STATUS_NOTRESPONDING:return"Rig is not responding";case o.STATUS_ONLINE:return"On-line"}},this.getFrequency=function(e){return h(e,"frequency")},this.setFrequency=function(e,n){l(e,"frequency",n),a(e,"freq",n)},this.getRxFrequency=function(e){return h(e,"rx-frequency")},this.getTxFrequency=function(e){return h(e,"tx-frequency")},this.getMode=function(e){return h(e,"mode")},this.setMode=function(e,n){a(e,"mode",n)},this.getPTT=function(e){return h(e,"ptt")||!1},this.setPTT=function(e,n){a(e,"ptt",!!n)},this.connect=function(){return"function"!=typeof WebSocket?(console.log("WebSocket not supported for you. Sorry."),!1):!t&&(t=!0,(n=new WebSocket(this.secureConnection?"wss://"+e+":34469":"ws://"+e+":34468")).onopen=u,n.onclose=r,n.onmessage=c,!0)},this.disconnect=function(){return t=i=!1,!!n&&(n.close(),!0)}}
