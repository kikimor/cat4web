function CAT4Web(){this.MODE_CW_U=8388608,this.MODE_CW_L=16777216,this.MODE_SSB_U=33554432,this.MODE_SSB_L=67108864,this.MODE_DIG_U=134217728,this.MODE_DIG_L=268435456,this.MODE_AM=536870912,this.MODE_FM=1073741824,this.STATUS_NOTCONFIGURED=0,this.STATUS_DISABLED=1,this.STATUS_PORTBUSY=2,this.STATUS_NOTRESPONDING=3,this.STATUS_ONLINE=4,this.reconnectTimeout=5e3,this.secureConnection="https:"===location.protocol;var t="cat4web.localhost.r8acc.ru",e=null,n=!1,o=!1,s=this,i={};function c(){var t=new XMLHttpRequest;t.open("POST","https://cat4web.r8acc.ru/licence/request",!0),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.onreadystatechange=function(){t.readyState===XMLHttpRequest.DONE&&(200===t.status?e.send("token:"+JSON.parse(t.responseText)):(e.close(),console.log("Could not get access key. Send mail to i@r8acc.ru.")))},t.send()}function u(){s.onDisconnect(),n&&(n=!1,setTimeout(function(){s.connect()},s.reconnectTimeout))}function r(t){var e=JSON.parse(t.data);if(!0===e.auth)o=!0,s.onConnect();else switch(e.type){case"status":l(e.rig,"status",null!==e.value?parseInt(e.value):null),s.onChangeStatus(e.rig,i[e.rig].status);break;case"freq":l(e.rig,"frequency",null!==e.value?parseInt(e.value):null),s.onChangeFrequency(e.rig,h(e.rig,"frequency"));break;case"mode":l(e.rig,"mode",null!==e.value?parseInt(e.value):null),s.onChangeMode(e.rig,h(e.rig,"mode"));break;case"ptt":l(e.rig,"ptt",!!e.value),s.onChangePTT(e.rig,h(e.rig,"ptt"))}}function a(t,o,s){n&&e.send(t+":"+o+":"+s)}function h(t,e){return t&&i[t]?i[t][e]:null}function l(t,e,n){t&&(i[t]||(i[t]={}),i[t][e]=n)}this.onConnect=function(){},this.onDisconnect=function(){},this.onChangeStatus=function(t,e){},this.onChangeFrequency=function(t,e){},this.onChangeMode=function(t,e){},this.onChangePTT=function(t,e){},this.isActive=function(){return o},this.getStatus=function(t){return h(t,"status")},this.getStatusText=function(t){switch(h(t,"status")){case s.STATUS_NOTCONFIGURED:return"Rig is not configured";case s.STATUS_DISABLED:return"Rig is disabled";case s.STATUS_PORTBUSY:return"Port is not available";case s.STATUS_NOTRESPONDING:return"Rig is not responding";case s.STATUS_ONLINE:return"On-line"}},this.getFrequency=function(t){return h(t,"frequency")},this.setFrequency=function(t,e){l(t,"frequency",e),a(t,"freq",e)},this.getMode=function(t){return h(t,"mode")},this.setMode=function(t,e){a(t,"mode",e)},this.getPTT=function(t){return h(t,"ptt")||!1},this.connect=function(){return"function"!=typeof WebSocket?(console.log("WebSocket not supported for you. Sorry."),!1):!n&&(n=!0,(e=new WebSocket(this.secureConnection?"wss://"+t+":34469":"ws://"+t+":34468")).onopen=c,e.onclose=u,e.onmessage=r,!0)},this.disconnect=function(){return n=o=!1,!!e&&(e.close(),!0)}}
